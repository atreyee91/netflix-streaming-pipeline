{
  "savedQueries": [
    {
      "name": "Event Hub Throughput (Messages/sec)",
      "category": "Pipeline Health",
      "query": "AzureMetrics\n| where ResourceProvider == 'MICROSOFT.EVENTHUB'\n| where MetricName == 'IncomingMessages'\n| summarize AvgMessagesPerSec = avg(Total) / 60 by bin(TimeGenerated, 1m)\n| order by TimeGenerated desc\n| take 60"
    },
    {
      "name": "Stream Analytics Input/Output Events",
      "category": "Pipeline Health",
      "query": "AzureMetrics\n| where ResourceProvider == 'MICROSOFT.STREAMANALYTICS'\n| where MetricName in ('InputEvents', 'OutputEvents', 'DroppedOrAdjustedEvents')\n| summarize Total = sum(Total) by MetricName, bin(TimeGenerated, 1m)\n| order by TimeGenerated desc"
    },
    {
      "name": "Cosmos DB RU Consumption",
      "category": "Pipeline Health",
      "query": "AzureMetrics\n| where ResourceProvider == 'MICROSOFT.DOCUMENTDB'\n| where MetricName == 'NormalizedRUConsumption'\n| summarize AvgRU = avg(Average), MaxRU = max(Maximum) by bin(TimeGenerated, 5m)\n| order by TimeGenerated desc"
    },
    {
      "name": "Azure Function Execution Errors",
      "category": "Error Tracking",
      "query": "requests\n| where success == false\n| where cloud_RoleName contains 'netflix'\n| summarize ErrorCount = count() by name, resultCode, bin(timestamp, 5m)\n| order by ErrorCount desc"
    },
    {
      "name": "Function Execution Duration (P99)",
      "category": "Performance",
      "query": "requests\n| where cloud_RoleName contains 'netflix'\n| summarize P50 = percentile(duration, 50), P95 = percentile(duration, 95), P99 = percentile(duration, 99) by name, bin(timestamp, 5m)\n| order by timestamp desc"
    },
    {
      "name": "Dead Letter Queue Events",
      "category": "Error Tracking",
      "query": "AzureDiagnostics\n| where ResourceProvider == 'MICROSOFT.EVENTHUB'\n| where EventHubName_s == 'netflix-events-dlq'\n| summarize DLQCount = count() by bin(TimeGenerated, 5m)\n| order by TimeGenerated desc"
    },
    {
      "name": "Data Lake Write Latency",
      "category": "Performance",
      "query": "StorageBlobLogs\n| where OperationName == 'PutBlob'\n| where AccountName contains 'nflxstream'\n| summarize AvgLatency = avg(DurationMs), P95Latency = percentile(DurationMs, 95) by bin(TimeGenerated, 5m)\n| order by TimeGenerated desc"
    },
    {
      "name": "End-to-End Pipeline Latency",
      "category": "Performance",
      "query": "AzureMetrics\n| where ResourceProvider == 'MICROSOFT.STREAMANALYTICS'\n| where MetricName == 'OutputWatermarkDelaySeconds'\n| summarize AvgDelay = avg(Average), MaxDelay = max(Maximum) by bin(TimeGenerated, 1m)\n| order by TimeGenerated desc"
    }
  ]
}
